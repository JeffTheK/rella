require 'rake/clean'

CXX = 'g++'

SRC_FILES = 'src/**.cpp'
TEST_FILES = 'test/**.cpp'

CLEAN.include 'bin/**'

task :test do
    TEST_FLAGS = '-Wall -Wextra -static-libstdc++ -O0 -g'
    OUT = '-o bin/test'
    system('rake clean')
    system("#{CXX} #{TEST_FLAGS} #{SRC_FILES} #{TEST_FILES} #{OUT}")
    system("./bin/test")
end

task :add_test do
    file_name = ARGV[1]
    raise('file already exists') if (File.exist?("test/#{file_name}"))

    text = <<-TEXT
#include "../include/doctest.h"
#include "../src/#{file_name}.hpp"

TEST_CASE("") {

}
TEXT

    File.open("test/#{file_name}_test.cpp", 'w') do |f|
        f << text
    end
    exit
end

task :add_class do
    file_name = ARGV[1]
    raise('file already exists') if (File.exist?("src/#{file_name}.hpp"))

    text = <<-TEXT
#pragma once

class #{file_name} {
public:

private:

};
TEXT

    File.open("src/#{file_name}.hpp", 'w') do |f|
        f << text
    end
    exit
end